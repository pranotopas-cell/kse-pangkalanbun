<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PT Khatulistiwa Sinar Energi - Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        .bg-hijau-tua { background-color: #064e3b; }
        .bg-hijau-tosca { background-color: #0d9488; }
        .text-hijau-tosca { color: #0d9488; }
        .section { display: none; }
        .section.active { display: block; }
        .group:hover .group-hover\:block { display: block; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">

    <nav class="bg-hijau-tua text-white shadow-xl sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3 cursor-pointer" onclick="showSection('home')">
                <div class="w-10 h-10 bg-hijau-tosca rounded-lg flex items-center justify-center font-bold shadow-lg text-white">KSE</div>
                <span class="text-xl font-bold tracking-tighter uppercase italic">PT KSE</span>
            </div>
            
            <div class="hidden md:flex items-center space-x-6 font-medium">
                <button onclick="showSection('home')" class="hover:text-teal-300">Home</button>
                
                <div class="relative group">
                    <button class="flex items-center hover:text-teal-300 py-2 outline-none">Berita</button>
                    <div class="absolute hidden group-hover:block bg-white text-gray-800 mt-0 w-56 rounded-md shadow-xl py-2 border-t-4 border-hijau-tosca">
                        <button onclick="showSection('harga-pertamina')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Update Harga Pertamina</button>
                        <button id="nav-edit-harga" onclick="showSection('admin-harga')" class="hidden block px-4 py-2 w-full text-left hover:bg-teal-50 text-orange-600 font-bold border-t">Ganti Harga Publish</button>
                    </div>
                </div>

                <div class="relative group">
                    <button class="flex items-center hover:text-teal-300 py-2 outline-none">Administrasi</button>
                    <div class="absolute hidden group-hover:block bg-white text-gray-800 mt-0 w-48 rounded-md shadow-xl py-2 border-t-4 border-hijau-tosca">
                        <button onclick="filterFiles('PO')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Purchase Order (PO)</button>
                        <button onclick="filterFiles('Surat Jalan')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Surat Jalan</button>
                        <button onclick="filterFiles('Invoice')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Invoice</button>
                        <button onclick="filterFiles('Faktur Pajak')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Faktur Pajak</button>
                    </div>
                </div>

                <div class="relative group">
                    <button class="flex items-center hover:text-teal-300 py-2 outline-none">Tentang Kami</button>
                    <div class="absolute hidden group-hover:block bg-white text-gray-800 mt-0 w-48 rounded-md shadow-xl py-2 border-t-4 border-hijau-tosca">
                        <button onclick="showSection('profile')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Profile</button>
                        <button onclick="showSection('visi-misi')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Visi & Misi</button>
                        <button onclick="showSection('legalitas')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Legalitas & Alamat</button>
                    </div>
                </div>
                
                <div id="nav-auth-container" class="border-l pl-6 border-teal-800">
                    <button id="btn-login-view" onclick="showSection('login')" class="bg-hijau-tosca px-6 py-1.5 rounded-full font-bold hover:bg-teal-500 shadow">Sign In</button>
                    <div id="user-logged-in" class="hidden flex items-center space-x-3">
                        <p id="display-email" class="text-sm font-bold text-teal-300"></p>
                        <button onclick="handleLogout()" class="bg-red-600 p-1.5 rounded-full hover:bg-red-700 shadow text-xs uppercase font-bold text-white">Logout</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-6 py-10">

        <section id="home" class="section active text-center py-12">
            <h1 class="text-5xl font-black text-hijau-tua mb-4 uppercase tracking-tighter">Mengalirkan Energi</h1>
            <img src="https://images.unsplash.com/photo-1581094288338-2314dddb7ecc?auto=format&fit=crop&w=800&q=80" class="w-full max-w-2xl mx-auto rounded-3xl shadow-2xl mb-6">
        </section>

        <section id="harga-pertamina" class="section">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-bold text-hijau-tua uppercase">Harga Publish BBM Industri</h2>
                <p class="text-hijau-tosca font-bold">Periode Terupdate Realtime</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-hijau-tua" id="cardwilayah1">
                    <h3 class="font-bold">Wilayah I</h3>
                    <p class="text-2xl font-black text-hijau-tua italic my-2">Rp 0</p>
                    <p class="keteranganKmr text-xs font-bold"></p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-hijau-tua" id="cardwilayah2">
                    <h3 class="font-bold">Wilayah II</h3>
                    <p class="text-2xl font-black text-hijau-tua italic my-2">Rp 0</p>
                    <p class="keteranganKmr text-xs font-bold"></p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-hijau-tua" id="cardwilayah3">
                    <h3 class="font-bold">Wilayah III</h3>
                    <p class="text-2xl font-black text-hijau-tua italic my-2">Rp 0</p>
                    <p class="keteranganKmr text-xs font-bold"></p>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-hijau-tua" id="cardwilayah4">
                    <h3 class="font-bold">Wilayah IV</h3>
                    <p class="text-2xl font-black text-hijau-tua italic my-2">Rp 0</p>
                    <p class="keteranganKmr text-xs font-bold"></p>
                </div>
            </div>
        </section>

        <section id="profile" class="section">
            <div class="bg-white p-10 rounded-2xl shadow-lg">
                <h2 class="text-2xl font-bold text-hijau-tua mb-4 uppercase">Company Profile</h2>
                <p class="text-gray-700 leading-relaxed text-lg">PT Khatulistiwa Sinar Energi (KSE) adalah mitra distribusi resmi produk BBM Industri Pertamina yang berfokus pada ketepatan pengiriman dan transparansi harga untuk mendukung operasional industri di seluruh Indonesia.</p>
            </div>
        </section>

        <section id="visi-misi" class="section">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-hijau-tua text-white p-10 rounded-2xl shadow-xl">
                    <h2 class="text-2xl font-bold mb-4 italic">Visi</h2>
                    <p>Menjadi pemimpin pasar dalam penyediaan energi terpadu di Indonesia dengan standar kualitas global.</p>
                </div>
                <div class="bg-hijau-tosca text-white p-10 rounded-2xl shadow-xl">
                    <h2 class="text-2xl font-bold mb-4 italic">Misi</h2>
                    <ul class="list-disc ml-5 space-y-2">
                        <li>Memberikan layanan prima tepat volume dan tepat waktu.</li>
                        <li>Membangun infrastruktur distribusi yang inovatif.</li>
                        <li>Menjaga integritas dalam setiap transaksi bisnis.</li>
                    </ul>
                </div>
            </div>
        </section>

        <section id="legalitas" class="section">
            <div class="bg-white p-10 rounded-2xl shadow-xl border-l-8 border-hijau-tua">
                <h2 class="text-xl font-bold mb-6 uppercase">Legalitas & Kontak</h2>
                <div class="grid md:grid-cols-2 gap-8 text-gray-700">
                    <div class="space-y-3">
                        <p><strong>NIB:</strong> 1289101110XXX</p>
                        <p><strong>NPWP:</strong> 01.234.567.8-XXX.000</p>
                        <p><strong>Izin Niaga:</strong> Terdaftar di ESDM & Migas</p>
                        <p><strong>Kantor:</strong> Gedung KSE, Jakarta Pusat, Indonesia</p>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-xl border">
                        <h3 class="font-bold mb-2">Layanan Cepat:</h3>
                        <a href="https://wa.me/6281234567890" target="_blank" class="block text-center bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 transition">Chat via WhatsApp</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="admin-harga" class="section">
            <div class="max-w-xl mx-auto bg-white p-8 rounded-2xl shadow-xl border-t-8 border-orange-500">
                <h2 class="text-xl font-bold mb-6 text-orange-600 uppercase">Update Harga Firestore</h2>
                <div class="space-y-4">
                    <div><label class="block text-xs font-bold mb-1">HARGA WILAYAH 1</label><input type="number" id="input-w1" class="w-full border p-2 rounded focus:ring-2 focus:ring-orange-300 outline-none"></div>
                    <div><label class="block text-xs font-bold mb-1">HARGA WILAYAH 2</label><input type="number" id="input-w2" class="w-full border p-2 rounded focus:ring-2 focus:ring-orange-300 outline-none"></div>
                    <div><label class="block text-xs font-bold mb-1">HARGA WILAYAH 3</label><input type="number" id="input-w3" class="w-full border p-2 rounded focus:ring-2 focus:ring-orange-300 outline-none"></div>
                    <div><label class="block text-xs font-bold mb-1">HARGA WILAYAH 4</label><input type="number" id="input-w4" class="w-full border p-2 rounded focus:ring-2 focus:ring-orange-300 outline-none"></div>
                    <button onclick="saveHargaBaru()" class="w-full bg-orange-600 text-white font-bold py-3 rounded-lg shadow-lg hover:bg-orange-700 transition">SIMPAN & PUBLIKASIKAN</button>
                </div>
            </div>
        </section>

        <section id="login" class="section">
            <div class="max-w-md mx-auto bg-white p-8 rounded-2xl shadow-2xl border-t-8 border-hijau-tua text-center">
                <h2 class="text-xl font-bold mb-6 uppercase">Admin Sign In</h2>
                <input type="email" id="email" class="w-full border p-3 rounded-lg mb-4" placeholder="Email">
                <input type="password" id="password" class="w-full border p-3 rounded-lg mb-6" placeholder="Password">
                <button onclick="handleLogin()" class="w-full bg-hijau-tua text-white py-3 rounded-lg font-bold shadow-lg">Masuk Dashboard</button>
            </div>
        </section>

        <section id="dashboard" class="section">
            <div class="flex justify-between items-center mb-6">
                <h2 id="dash-title" class="text-2xl font-bold text-hijau-tua italic uppercase tracking-widest">Arsip Dokumen</h2>
            </div>
            <div class="bg-white rounded-xl shadow-xl overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-hijau-tua text-white font-bold">
                        <tr><th class="px-6 py-4">Kategori</th><th class="px-6 py-4">Keterangan Dokumen</th><th class="px-6 py-4 text-center">Aksi</th></tr>
                    </thead>
                    <tbody id="file-table-body" class="divide-y text-sm italic">
                        </tbody>
                </table>
            </div>
        </section>

    </main>

    <script>
        // -- INITIALIZE FIREBASE (FIRESTORE) --
        const firebaseConfig = {
            apiKey: "AIzaSyDenqfuE7Sjy773lp3k7WYh_3RRSr3nojM",
            authDomain: "kse-harga-bbm-update.firebaseapp.com",
            projectId: "kse-harga-bbm-update",
            storageBucket: "kse-harga-bbm-update.firebasestorage.app",
            messagingSenderId: "764165984284",
            appId: "1:764165984284:web:a74aed43317539f5f1cfd9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // -- INITIALIZE SUPABASE --
        const _supabase = supabase.createClient("https://secasrbeamduxqxwlspv.supabase.co", "sb_publishable_caJyFg1_Z89oUhtKg5XyoA_DfIgh6br");

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }

        // -- AMBIL DATA HARGA --
        let hargaSekarangGlobal = {};
        function loadHarga() {
            db.collection("hargaBBM").doc("periode").onSnapshot((doc) => {
                if (!doc.exists) return;
                const data = doc.data();
                hargaSekarangGlobal = data.sekarang || {};

                ["wilayah1", "wilayah2", "wilayah3", "wilayah4"].forEach(w => {
                    const now = parseInt(data.sekarang?.[w] || 0);
                    const prev = parseInt(data.kemarin?.[w] || 0);
                    const diff = now - prev;
                    
                    const card = document.getElementById(`card${w}`);
                    card.querySelector('p.italic').innerText = `Rp ${now.toLocaleString()}`;
                    
                    const ket = card.querySelector('.keteranganKmr');
                    if(diff > 0) { ket.innerText = `▲ Naik Rp ${diff.toLocaleString()}`; ket.style.color = "red"; }
                    else if(diff < 0) { ket.innerText = `▼ Turun Rp ${Math.abs(diff).toLocaleString()}`; ket.style.color = "green"; }
                    else { ket.innerText = "● Stabil"; ket.style.color = "gray"; }
                });
            });
        }

        // -- UPDATE HARGA (ADMIN ONLY) --
        async function saveHargaBaru() {
            const val = [
                document.getElementById('input-w1').value,
                document.getElementById('input-w2').value,
                document.getElementById('input-w3').value,
                document.getElementById('input-w4').value
            ];
            if(val.includes("")) return alert("Lengkapi semua input!");

            try {
                await db.collection("hargaBBM").doc("periode").update({
                    kemarin: hargaSekarangGlobal,
                    sekarang: { wilayah1: val[0], wilayah2: val[1], wilayah3: val[2], wilayah4: val[3] }
                });
                alert("Harga Berhasil di Update!");
                showSection('harga-pertamina');
            } catch (e) { alert("Gagal Simpan. Periksa Login Admin Anda."); }
        }

        // -- AUTH & DASHBOARD --
        async function handleLogin() {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            const { data, error } = await _supabase.auth.signInWithPassword({ email: e, password: p });
            if (error) return alert("Login Gagal!");
            updateAuthUI(data.user);
        }

        function updateAuthUI(user) {
            if (!user) return;
            document.getElementById('btn-login-view').classList.add('hidden');
            document.getElementById('user-logged-in').classList.remove('hidden');
            document.getElementById('display-email').innerText = user.email;
            document.getElementById('nav-edit-harga').classList.remove('hidden');
            showSection('dashboard');
            loadFiles();
        }

        async function loadFiles(filter = null) {
            let query = _supabase.from('documents').select('*').order('created_at', { ascending: false });
            if (filter) query = query.eq('type', filter);
            const { data } = await query;
            const tbody = document.getElementById('file-table-body');
            tbody.innerHTML = data.map(f => `
                <tr>
                    <td class="px-6 py-4 font-bold text-hijau-tosca uppercase">${f.type}</td>
                    <td class="px-6 py-4">${f.name}</td>
                    <td class="px-6 py-4 text-center"><a href="${f.url}" target="_blank" class="bg-hijau-tua text-white px-4 py-1 rounded shadow text-xs">VIEW</a></td>
                </tr>
            `).join('');
        }

        function filterFiles(type) {
            showSection('dashboard');
            document.getElementById('dash-title').innerText = "Arsip: " + type;
            loadFiles(type);
        }

        async function handleLogout() { await _supabase.auth.signOut(); location.reload(); }

        // START
        loadHarga();
        _supabase.auth.getSession().then(({data}) => { if (data.session) updateAuthUI(data.session.user); });

    </script>
</body>
</html>








