<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KSE_e-Documents</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #fcfdfe; scroll-behavior: smooth; }
        .kse-gradient { background: linear-gradient(135deg, #064e3b 0%, #065f46 100%); }
        .page, .section { display: none; }
        .active { display: block; }
        .flex-active { display: flex; }
        .btn-hover { transition: all 0.3s ease; }
        .btn-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        .dropdown:hover .dropdown-menu { display: block !important; }
        .dropdown-menu { display: none; }
    </style>
</head>
<body class="text-slate-900">

    <main id="page-login" class="page min-h-screen items-center justify-center p-6 bg-[#f8fafc]">
        <div class="container mx-auto flex flex-col md:flex-row items-center gap-16">
            <div class="text-center space-y-6 flex-1">
                <img src="logo.png" class="w-64 mx-auto">
                <h1 class="text-5xl font-extrabold text-[#064e3b]">PT.KHATULISTIWA SINAR ENERGI</h1>
                <p class="text-2xl font-semibold text-emerald-600">Sinergi Mengalirkan Energi</p>
                <p class="italic text-gray-500">"Energi Hebat, Mitra Sahabat, Harga Hemat"</p>
            </div>
            
            <div class="bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm border border-slate-100">
                <h2 class="font-bold text-slate-800 mb-6 text-center text-xl uppercase tracking-tight">Masuk Dashboard</h2>
                <div class="space-y-4">
                    <input type="email" id="login-email" placeholder="Email" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:border-teal-500 font-semibold transition-all">
                    <input type="password" id="login-pass" placeholder="Password" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:border-teal-500 font-semibold transition-all">
                    <button onclick="handleLogin()" class="w-full kse-gradient text-white py-4 rounded-xl font-bold uppercase tracking-widest btn-hover shadow-lg">Login</button>
                    
                    <div class="text-center pt-2">
                        <button onclick="handleForgotPassword()" class="text-xs font-bold text-slate-400 hover:text-emerald-600 transition-colors uppercase tracking-widest">Lupa Password?</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <main id="page-dashboard" class="page flex-col min-h-screen">
        <nav class="kse-gradient text-white px-10 py-5 flex justify-between items-center sticky top-0 z-[100] shadow-xl">
            <div class="flex items-center gap-4 cursor-pointer" onclick="showSection('profile')">
                <img src="assets/logo-full.png" class="h-10 rounded bg-white p-1">
                <h1 class="text-xl font-bold tracking-tighter hidden md:block">PT.KHATULISTIWA SINAR ENERGI</h1>
            </div>
            
            <div class="flex items-center space-x-8">
                <div class="relative dropdown group">
                    <button class="text-xs font-bold uppercase tracking-widest opacity-80 hover:opacity-100 py-2">Company Profile ▼</button>
                    <div class="dropdown-menu absolute right-0 md:left-0 w-56 bg-white border shadow-2xl rounded-2xl py-2 mt-2 z-[110] text-slate-700 font-semibold text-xs overflow-hidden">
                        <button onclick="showSection('profile')" class="block w-full text-left px-6 py-4 hover:bg-teal-50 border-b border-slate-50">Profil Perusahaan</button>
                        <button onclick="showSection('visi-misi')" class="block w-full text-left px-6 py-4 hover:bg-teal-50 border-b border-slate-50">Visi & Misi Kami</button>
                        <button onclick="showSection('legalitas')" class="block w-full text-left px-6 py-4 hover:bg-teal-50 border-b border-slate-50">Legalitas & Izin</button>
                        <button onclick="showSection('armada')" class="block w-full text-left px-6 py-4 hover:bg-teal-50">Data Armada </button>
                        <button onclick="showSection('kontak')" class="block w-full text-left px-6 py-4 hover:bg-teal-50">Hubungi Kami</button>
                    </div>
                </div>

                <div class="relative dropdown group text-teal-300">
                    <button class="text-xs font-bold uppercase tracking-widest py-2">E-Document ▼</button>
                    <div class="dropdown-menu absolute right-0 w-56 bg-white border shadow-2xl rounded-2xl py-2 mt-2 z-[110] text-slate-700 font-semibold text-xs overflow-hidden">
                        <button onclick="loadDocuments('PURCHASE ORDER')" class="block w-full text-left px-6 py-4 hover:bg-teal-50 border-b border-slate-50">Purchase Order (PO)</button>
                        <button onclick="loadDocuments('SURAT JALAN')" class="block w-full text-left px-6 py-4 hover:bg-teal-50 border-b border-slate-50">Surat Jalan</button>
                        <button onclick="loadDocuments('INVOICE')" class="block w-full text-left px-6 py-4 hover:bg-teal-50 border-b border-slate-50">Invoice</button>
                        <button onclick="loadDocuments('FAKTUR PAJAK')" class="block w-full text-left px-6 py-4 hover:bg-teal-50 text-red-600">Faktur Pajak</button>
                    </div>
                </div>
                
                <button onclick="showSection('harga')" class="text-xs font-bold uppercase tracking-widest opacity-80 hover:opacity-100">Publish Pertamina</button>
                
                <div class="flex flex-col items-end border-l border-white/20 pl-6 space-y-1">
                    <span id="display-user-email" class="text-[10px] font-bold text-emerald-300 tracking-tight lowercase truncate max-w-[150px]">user@email.com</span>
                    <button onclick="handleLogout()" class="bg-red-500 hover:bg-red-600 px-3 py-1.5 rounded-md text-[9px] font-black transition-all uppercase tracking-tighter">sign out</button>
                </div>
            </div>
        </nav>

        <div class="container mx-auto px-6 md:px-10 py-10 flex-1">
            
            <div id="admin-panel" class="hidden mb-10 bg-white p-8 rounded-[2rem] border border-slate-200 shadow-sm">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-6 bg-teal-500 rounded-full"></div>
                    <h3 class="font-bold uppercase text-slate-800 tracking-tight">Admin  Dashboard</h3>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-4 items-end">
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold uppercase text-slate-400">1. Pilih File</label>
                        <input type="file" id="file-input" class="w-full p-3 bg-slate-50 rounded-xl text-xs border border-slate-200">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold uppercase text-slate-400">2. Kategori</label>
                        <select id="doc-category" class="w-full p-3 bg-slate-50 rounded-xl text-xs border border-slate-200">
                            <option value="PURCHASE ORDER">PURCHASE ORDER</option>
                            <option value="SURAT JALAN">SURAT JALAN</option>
                            <option value="INVOICE">INVOICE</option>
                            <option value="FAKTUR PAJAK">FAKTUR PAJAK</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold uppercase text-slate-400">3. Target Email Client</label>
                        <input type="text" id="manual-uid" placeholder="Ketik email..." class="w-full p-3 bg-slate-50 rounded-xl text-xs border border-slate-200">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-bold uppercase text-slate-400">4. History Client</label>
                        <select id="select-penerima-history" onchange="syncManualUid(this.value)" class="w-full p-3 bg-teal-50 text-teal-700 rounded-xl font-bold text-xs border border-teal-100">
                            <option value="">-- History --</option>
                        </select>
                    </div>
                    <button onclick="startUploadProcess()" id="btn-upload" class="bg-[#064e3b] text-white p-4 rounded-xl font-bold text-xs uppercase btn-hover shadow-lg">Upload</button>
                </div>
            </div>

            <section id="section-profile" class="section active">
                <div class="kse-gradient p-12 md:p-20 rounded-[3rem] text-white shadow-2xl relative overflow-hidden">
                    <div class="relative z-10">
                        <h2 class="text-5xl font-black mb-8 tracking-tighter uppercase italic">Profil Perusahaan</h2>
                        <div class="space-y-6 text-lg md:text-xl font-light opacity-95 leading-relaxed max-w-4xl">
                            <p>
                                <strong>PT Khatulistiwa Sinar Energi (KSE)</strong> merupakan entitas bisnis yang berdedikasi tinggi dalam manajemen logistik dan penyaluran bahan bakar minyak (BBM) non-subsidi untuk sektor industri. Berbasis strategis di Kalimantan Tengah, kami memahami bahwa energi adalah urat nadi bagi kemajuan setiap operasional industri.
                            </p>
                            <p>
                                Kami hadir untuk menjembatani kebutuhan energi dengan standar pelayanan kelas dunia. Dengan dukungan infrastruktur armada yang modern dan manajemen rantai pasok yang terintegrasi, KSE berkomitmen untuk memastikan setiap liter BBM sampai ke titik lokasi pelanggan dengan kualitas terjaga, volume yang akurat, dan ketepatan waktu yang maksimal.
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="section-visi-misi" class="section">
                <div class="grid md:grid-cols-2 gap-10">
                    <div class="bg-white p-12 rounded-[2.5rem] shadow-xl border-t-8 border-emerald-600">
                        <h2 class="text-sm font-black text-emerald-600 uppercase mb-6 tracking-widest italic">— Vision</h2>
                        <p class="text-3xl font-bold text-slate-800 italic leading-snug">
                            "Menjadi Perusahaan Nasional dalam  distribusi energi BBM industri terdepan di wilayah Kalimantan yang diakui atas keunggulan operasional dan integritas."
                        </p>
                    </div>
                    <div class="bg-white p-12 rounded-[2.5rem] shadow-xl border-t-8 border-emerald-800">
                        <h2 class="text-sm font-black text-emerald-800 uppercase mb-6 tracking-widest italic">— Mission</h2>
                        <ul class="space-y-4 text-slate-600 font-medium italic text-lg">
                            <li class="flex gap-4"><span class="text-emerald-600 font-bold">01.</span><span>Menjamin ketersediaan pasokan energi yang stabil dan berkualitas.</span></li>
                            <li class="flex gap-4"><span class="text-emerald-600 font-bold">02.</span><span>Menerapkan teknologi logistik terkini untuk transparansi pengiriman.</span></li>
                            <li class="flex gap-4"><span class="text-emerald-600 font-bold">03.</span><span>Menjaga kepatuhan penuh terhadap regulasi lingkungan dan hukum energi.</span></li>
                        </ul>
                    </div>
                </div>
            </section>

            <section id="section-legalitas" class="section">
    <div class="bg-white p-12 rounded-[3rem] shadow-xl max-w-4xl border-l-8 border-teal-600">
        <h2 class="text-3xl font-bold text-[#064e3b] mb-8 uppercase italic border-b pb-4">Legalitas & Izin</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-slate-700 font-bold uppercase text-sm italic">
            <div class="p-4 bg-slate-50 rounded-2xl flex items-center gap-3"><span class="text-emerald-600 text-xl">✓</span> Izin Mitra Penyalur dari BPU INU</div>
            <div class="p-4 bg-slate-50 rounded-2xl flex items-center gap-3"><span class="text-emerald-600 text-xl">✓</span> Izin Khusus B3 dan Kartu Pengawasan Transportasi BBM Industri</div>
            <div class="p-4 bg-slate-50 rounded-2xl flex items-center gap-3"><span class="text-emerald-600 text-xl">✓</span> Sertifikasi Standar Quantity Ukuran dari Metrologi</div>
            <div class="p-4 bg-slate-50 rounded-2xl flex items-center gap-3"><span class="text-emerald-600 text-xl">✓</span> Dokumen Lingkungan & K3S  serta Amdalnet</div>
        </div>
    </div>
</section>

<section id="section-armada" class="section">
    <div class="mb-8 flex items-center gap-3">
        <div class="w-2 h-8 bg-teal-600 rounded-full"></div>
        <h2 class="text-2xl font-bold text-slate-800 uppercase italic tracking-tight">Kesiapan Armada Logistik</h2>
    </div>
    
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white p-8 rounded-[2.5rem] text-center shadow-lg border-b-8 border-teal-500 transform transition hover:scale-105">
            <span class="block text-4xl font-black text-[#064e3b]">5.000 L</span>
            <span class="text-xs font-bold text-slate-400 uppercase mt-2 block tracking-widest">Small Tank Truck</span>
        </div>
        <div class="bg-white p-8 rounded-[2.5rem] text-center shadow-lg border-b-8 border-teal-500 transform transition hover:scale-105">
            <span class="block text-4xl font-black text-[#064e3b]">10.000 L</span>
            <span class="text-xs font-bold text-slate-400 uppercase mt-2 block tracking-widest">Medium Tank Truck</span>
        </div>
        <div class="bg-white p-8 rounded-[2.5rem] text-center shadow-lg border-b-8 border-teal-500 transform transition hover:scale-105">
            <span class="block text-4xl font-black text-[#064e3b]">20.000 L</span>
            <span class="text-xs font-bold text-slate-400 uppercase mt-2 block tracking-widest">Large Tank Truck</span>
        </div>
    </div>
</section>

<section id="section-kontak" class="section">
    <div class="mb-10 text-center">
        <h2 class="text-2xl font-bold text-slate-800 uppercase italic">Hubungi Kami</h2>
        <p class="text-sm text-slate-500 font-semibold italic">Layanan Support & Informasi PT. KSE</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white p-8 rounded-[2.5rem] text-center shadow-lg border-b-8 border-emerald-500 transform transition hover:scale-105">
            <span class="text-xs font-bold text-slate-400 uppercase mb-4 block tracking-widest">Hotline / WhatsApp</span>
            <a href="https://wa.me/6281158841410" target="_blank" class="block text-2xl font-black text-[#064e3b] hover:text-emerald-600 transition-colors italic">
                0811-5884-1410
            </a>
        </div>
        
        <div class="bg-white p-8 rounded-[2.5rem] text-center shadow-lg border-b-8 border-emerald-500 transform transition hover:scale-105">
            <span class="text-xs font-bold text-slate-400 uppercase mb-4 block tracking-widest">Email Official</span>
            <span class="block text-sm font-bold text-[#064e3b] break-all leading-relaxed lowercase">
                pt.khatulistiwa.sinar.energi@gmail.com
            </span>
        </div>

        <div class="bg-white p-8 rounded-[2.5rem] text-center shadow-lg border-b-8 border-emerald-500 transform transition hover:scale-105">
            <span class="text-xs font-bold text-slate-400 uppercase mb-4 block tracking-widest">Branch Office</span>
            <span class="block text-sm font-bold text-[#064e3b] leading-snug italic">
                Jl. H.M Rafi' RT.24<br>Pangkalan Bun, Kalteng
            </span>
        </div>
    </div>
</section>
            
            <section id="section-harga" class="section">
                <div class="mb-10 flex items-center justify-between">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800 uppercase italic">Publish Harga Keekonomian Pertamina Patra Niaga</h2>
                        <p class="text-sm text-slate-500 font-semibold italic">Update otomatis sesuai periode resmi Pertamina Patra Niaga</p>
                    </div>
                    <div class="h-10 w-10 bg-emerald-500 rounded-full animate-pulse shadow-[0_0_15px_rgba(16,185,129,0.5)]"></div>
                </div>
                <div id="harga-grid" class="grid grid-cols-1 md:grid-cols-4 gap-6"></div>
            </section>

            <section id="section-documents" class="section">
                <div class="bg-white rounded-[2.5rem] shadow-xl overflow-hidden border border-slate-100">
                    <div class="p-8 border-b border-slate-50 bg-slate-50 flex justify-between items-center">
                        <h3 id="doc-title" class="font-bold uppercase text-slate-800 tracking-tight italic">Repository</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <tbody id="file-table-body" class="divide-y divide-slate-50"></tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <script>
        const SB_URL = "https://yqdtgcjpfhiskywhowhu.supabase.co"; 
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlxZHRnY2pwZmhpc2t5d2hvd2h1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1MDY0MTIsImV4cCI6MjA4NzA4MjQxMn0.Mlw3e8C4xKHcJPSMRkcsRXL5udtR9SeWk2GmqM1NyYc";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        const firebaseConfig = { projectId: "kse-harga-bbm-update", apiKey: "AIzaSyDenqfuE7Sjy773lp3k7WYh_3RRSr3nojM" };
        firebase.initializeApp(firebaseConfig);
        const dbFirebase = firebase.firestore();

        let currentUser = null;
        let isAdmin = false;

        async function checkAuth() {
            const { data: { session } } = await _supabase.auth.getSession();
            if (session) {
                currentUser = session.user;
                isAdmin = currentUser.email === "pt.khatulistiwa.sinar.energi@gmail.com";
                
                // UPDATE: Tampilkan Email di Navigasi
                document.getElementById('display-user-email').innerText = currentUser.email;

                if(isAdmin) {
                    document.getElementById('admin-panel').classList.remove('hidden');
                    loadHistoryReceivers(); 
                }
                document.getElementById('page-login').classList.remove('active', 'flex-active');
                document.getElementById('page-dashboard').classList.add('flex-active');
                initHarga();
                showSection('profile');
            } else {
                document.getElementById('page-login').classList.add('flex-active');
            }
        }

        async function handleLogin() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            if(!email || !pass) return alert("Email & Password wajib diisi!");
            const { error } = await _supabase.auth.signInWithPassword({ email, password: pass });
            if (error) alert("Gagal masuk: " + error.message); else location.reload();
        }

        function handleForgotPassword() {
            const email = document.getElementById('login-email').value;
            if(!email) return alert("Masukkan email Anda terlebih dahulu di kotak email!");
            alert("Sistem akan mengirimkan tautan atur ulang password ke: " + email + "\n(Pastikan email Anda sudah terdaftar)");
            _supabase.auth.resetPasswordForEmail(email);
        }

        async function handleLogout() { await _supabase.auth.signOut(); location.reload(); }

        function initHarga() {
            dbFirebase.collection("hargaBBM").doc("periode").onSnapshot(doc => {
                if(doc.exists) {
                    const data = doc.data().sekarang || {};
                    const grid = document.getElementById('harga-grid'); 
                    grid.innerHTML = "";
                    const wilayahNama = { 1: "Jawa-Bali-Madura", 2: "Kalimantan", 3: "Sulawesi", 4: "Papua & Maluku" };

                    for(let i = 1; i <= 4; i++) {
                        const h = parseInt(data['wilayah' + i] || 0);
                        const naik = parseInt(data['kenaikan' + i] || 0);
                        const card = document.createElement("div");
                        card.className = "bg-white p-8 rounded-[2.5rem] border-b-8 border-emerald-500 text-center shadow-xl transform transition hover:scale-105";
                        card.innerHTML = `
                            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">${wilayahNama[i]}</span>
                            <h3 id="harga${i}" class="text-3xl font-black text-[#064e3b] italic leading-none mt-4">Rp 0</h3>
                            <p class="text-[10px] text-emerald-600 font-bold mt-4 uppercase">Update Terkini</p>
                        `;
                        grid.appendChild(card);
                        animateValue(document.getElementById(`harga${i}`), 0, h);
                    }
                }
            });
        }

        function animateValue(el, start, end, duration = 800) {
            let startTime = null;
            function step(timestamp) {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / duration, 1);
                const value = Math.floor(progress * (end - start) + start);
                el.textContent = "Rp " + value.toLocaleString('id-ID');
                if (progress < 1) requestAnimationFrame(step);
            }
            requestAnimationFrame(step);
        }

        async function loadDocuments(cat) {
            showSection('documents');
            document.getElementById('doc-title').innerText = cat;
            let q = _supabase.from('documents').select('*').eq('type', cat).order('created_at', { ascending: false });
            if(!isAdmin) q = q.eq('user_id', currentUser.email);
            const { data } = await q;
            const tbody = document.getElementById('file-table-body');
            tbody.innerHTML = data?.length ? data.map(d => {
                let btnAction = isAdmin ? `<button onclick="deleteFile('${d.id}')" class="bg-red-500 text-white px-4 py-2 rounded-lg text-[10px] font-bold uppercase">Hapus</button>` : `<a href="${d.url}" download class="bg-slate-900 text-white px-4 py-2 rounded-lg text-[10px] font-bold uppercase">Download</a>`;
                return `<tr class="hover:bg-slate-50 transition-colors"><td class="p-6">
                        <div class="font-bold text-slate-700 uppercase italic text-sm">${d.name}</div>
                        ${isAdmin ? `<div class="text-[9px] text-teal-600 font-bold">To: ${d.user_id}</div>` : ''}
                        </td><td class="p-6 text-right space-x-3">
                        <button onclick="window.open('${d.url}', '_blank')" class="text-[10px] font-bold uppercase text-teal-600 border border-teal-200 px-4 py-2 rounded-lg">Preview</button>
                        ${btnAction}</td></tr>`;
            }).join('') : `<tr><td colspan="2" class="p-20 text-center text-slate-300 font-bold uppercase italic text-sm">Data Kosong</td></tr>`;
        }

        async function loadHistoryReceivers() {
            const { data } = await _supabase.from('documents').select('user_id');
            const uniqueEmails = [...new Set(data?.map(d => d.user_id))];
            const select = document.getElementById('select-penerima-history');
            uniqueEmails.forEach(email => { if(email) select.innerHTML += `<option value="${email}">${email}</option>`; });
        }

        function syncManualUid(val) { if(val) document.getElementById('manual-uid').value = val; }

        async function startUploadProcess() {
            const fileInput = document.getElementById('file-input');
            const target = document.getElementById('manual-uid').value;
            if(!fileInput.files[0] || !target) return alert("Lengkapi data!");
            const btn = document.getElementById('btn-upload'); btn.innerText = "PROSES..."; btn.disabled = true;
            const file = fileInput.files[0];
            const fileName = `${Date.now()}_${file.name}`;
            await _supabase.storage.from('kse-files').upload(fileName, file);
            const { data: urlData } = _supabase.storage.from('kse-files').getPublicUrl(fileName);
            await _supabase.from('documents').insert([{ name: file.name, url: urlData.publicUrl, type: document.getElementById('doc-category').value, user_id: target }]);
            location.reload();
        }

        async function deleteFile(id) { if(confirm("Hapus?")) { await _supabase.from('documents').delete().eq('id', id); location.reload(); } }

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('section-' + id).classList.add('active');
            window.scrollTo(0,0);
        }

        window.onload = checkAuth;
    </script>
</body>
</html>













