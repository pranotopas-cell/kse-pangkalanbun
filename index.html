<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard Dokumen</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f1f5f9;
    margin:0;
    padding:40px;
}
.container{
    max-width:900px;
    margin:auto;
    background:white;
    padding:30px;
    border-radius:12px;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
}
h1{
    margin-top:0;
}
button{
    background:#064e3b;
    color:white;
    border:none;
    padding:10px 20px;
    border-radius:6px;
    cursor:pointer;
}
button:hover{
    background:#022c22;
}
table{
    width:100%;
    border-collapse:collapse;
    margin-top:25px;
}
td,th{
    padding:12px;
    border-bottom:1px solid #e2e8f0;
}
th{
    text-align:left;
    background:#f8fafc;
}
.tag{
    background:#e2e8f0;
    padding:3px 10px;
    border-radius:6px;
    font-size:12px;
    font-weight:bold;
}
</style>
</head>
<body>

<div class="container">

<h1>üìÅ Dashboard Dokumen</h1>

<h3>Upload Dokumen (Admin)</h3>

<select id="jenis">
<option value="po">PO</option>
<option value="invoice">Invoice</option>
<option value="surat jalan">Surat Jalan</option>
</select>

<input type="file" id="file">

<button onclick="upload()">Upload</button>

<hr>

<h3>Daftar Dokumen</h3>

<table>
<thead>
<tr>
<th>Jenis</th>
<th>Nama</th>
<th>Download</th>
</tr>
</thead>
<tbody id="list"></tbody>
</table>

</div>

<script>
const supabase = window.supabase.createClient(
"https://wrkmmeojhqpxchetaltl.supabase.co",
"sb_publishable_HAdGJewkvKqOZ0cX7qPSZw_DjMDcATK"
);

// LOAD DATA
async function load(){

const {data,error} = await supabase
.from("documents")
.select("*")
.order("created_at",{ascending:false});

if(error){
console.log(error);
return;
}

const list = document.getElementById("list");

list.innerHTML = data.map(d=>`
<tr>
<td><span class="tag">${d.jenis}</span></td>
<td>${d.nomor}</td>
<td><a href="${d.file_url}" target="_blank">Download</a></td>
</tr>
`).join("");

}

load();


// UPLOAD FILE
async function upload(){

const fileInput=document.getElementById("file");
const jenis=document.getElementById("jenis").value;

if(!fileInput.files[0]){
alert("Pilih file dulu");
return;
}

const file=fileInput.files[0];
const fileName=Date.now()+"_"+file.name.replace(/\s/g,"_");

// upload storage
const {error:uploadError}=await supabase.storage
.from("documents")
.upload(fileName,file);

if(uploadError){
alert(uploadError.message);
return;
}

// ambil url
const {data:urlData}=supabase.storage
.from("documents")
.getPublicUrl(fileName);

// simpan db
const {error:dbError}=await supabase
.from("documents")
.insert([{
jenis:jenis,
nomor:file.name,
file_url:urlData.publicUrl
}]);

if(dbError){
alert(dbError.message);
return;
}

alert("Upload berhasil");
fileInput.value="";
load();

}
</script>

</body>
</html>
