<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PT Khatulistiwa Sinar Energi - Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <style>
        .bg-hijau-tua { background-color: #064e3b; }
        .bg-hijau-tosca { background-color: #0d9488; }
        .text-hijau-tosca { color: #0d9488; }
        .section { display: none; }
        .section.active { display: block; }
        .group:hover .group-hover\:block { display: block; }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">

    <nav class="bg-hijau-tua text-white shadow-xl sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3 cursor-pointer" onclick="showSection('home')">
                <div class="w-10 h-10 bg-hijau-tosca rounded-lg flex items-center justify-center font-bold shadow-lg text-white">KSE</div>
                <span class="text-xl font-bold tracking-tighter">PT KHATULISTIWA SINAR ENERGI</span>
            </div>
            
            <div class="hidden md:flex items-center space-x-6 font-medium">
                <button onclick="showSection('home')" class="hover:text-teal-300 transition">Home</button>
                
                <div class="relative group">
                    <button class="flex items-center hover:text-teal-300 outline-none">Berita</button>
                    <div class="absolute hidden group-hover:block bg-white text-gray-800 mt-0 w-56 rounded-md shadow-xl py-2 border-t-4 border-hijau-tosca">
                        <button onclick="showSection('harga-pertamina')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Update Harga Pertamina</button>
                    </div>
                </div>

                <div class="relative group">
                    <button class="flex items-center hover:text-teal-300 outline-none">Administrasi</button>
                    <div class="absolute hidden group-hover:block bg-white text-gray-800 mt-0 w-48 rounded-md shadow-xl py-2 border-t-4 border-hijau-tosca">
                        <button onclick="filterFiles('PO')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Purchase Order (PO)</button>
                        <button onclick="filterFiles('Surat Jalan')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Surat Jalan</button>
                        <button onclick="filterFiles('Invoice')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Invoice</button>
                        <button onclick="filterFiles('Faktur Pajak')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Faktur Pajak</button>
                    </div>
                </div>

                <div class="relative group">
                    <button class="flex items-center hover:text-teal-300 outline-none">Tentang Kami</button>
                    <div class="absolute hidden group-hover:block bg-white text-gray-800 mt-0 w-48 rounded-md shadow-xl py-2 border-t-4 border-hijau-tosca">
                        <button onclick="showSection('profile')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Profile</button>
                        <button onclick="showSection('visi-misi')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Visi & Misi</button>
                        <button onclick="showSection('legalitas')" class="block px-4 py-2 w-full text-left hover:bg-teal-50">Legalitas & Alamat</button>
                    </div>
                </div>
                
                <div id="nav-auth-container" class="border-l pl-6 border-teal-800">
                    <button id="btn-login-view" onclick="showSection('login')" class="bg-hijau-tosca px-6 py-1.5 rounded-full font-bold hover:bg-teal-500 shadow">Sign In</button>
                    <div id="user-logged-in" class="hidden flex items-center space-x-3">
                        <div class="text-right leading-tight">
                            <p id="display-email" class="text-sm font-bold text-teal-300"></p>
                        </div>
                        <button onclick="handleLogout()" class="bg-red-600 p-1.5 rounded-full hover:bg-red-700 shadow">
                            <svg class="w-4 h-4 text-white mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M17 16l4-4m0 0l-4-4m4 4H7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-6 py-10">

        <section id="home" class="section active text-center py-12">
            <h1 class="text-5xl font-black text-hijau-tua mb-4 uppercase">Mengalirkan Energi Terbaik</h1>
            <p class="text-gray-600 mb-10 max-w-2xl mx-auto italic">Penyedia solusi energi berkelanjutan untuk industri Indonesia.</p>
            <img src="https://images.unsplash.com/photo-1581094288338-2314dddb7ecc?auto=format&fit=crop&w=1200&q=80" class="w-full max-w-4xl mx-auto rounded-3xl shadow-2xl border-b-8 border-hijau-tosca">
        </section>

        <section id="harga-pertamina" class="section">
            <h2 class="text-3xl font-bold text-hijau-tua mb-8 text-center uppercase tracking-widest">Update Harga Publish Pertamina</h2>
            
            <div class="mb-12">
                <h3 class="text-hijau-tua font-bold mb-4 border-l-4 border-hijau-tosca pl-3">Periode 15 - 28 Februari 2026</h3>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-hijau-tua">
                        <h4 class="font-bold text-gray-500 text-xs">WILAYAH 1 & 2</h4>
                        <p id="h-now-w12" class="text-3xl font-black text-hijau-tua mt-2 italic">Rp 0</p>
                        <small id="desc-w12" class="font-medium"></small>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-hijau-tua">
                        <h4 class="font-bold text-gray-500 text-xs">WILAYAH 3</h4>
                        <p id="h-now-w3" class="text-3xl font-black text-hijau-tua mt-2 italic">Rp 0</p>
                        <small id="desc-w3" class="font-medium"></small>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-lg border-t-4 border-hijau-tua">
                        <h4 class="font-bold text-gray-500 text-xs">WILAYAH 4</h4>
                        <p id="h-now-w4" class="text-3xl font-black text-hijau-tua mt-2 italic">Rp 0</p>
                        <small id="desc-w4" class="font-medium"></small>
                    </div>
                </div>
            </div>

            <div>
                <h3 class="text-gray-400 font-bold mb-4 border-l-4 border-gray-300 pl-3">Periode 01 - 14 Februari 2026</h3>
                <div class="grid md:grid-cols-3 gap-6 opacity-80">
                    <div class="bg-white p-6 rounded-2xl shadow border-t-4 border-gray-300">
                        <h4 class="font-bold text-gray-400 text-xs text-hijau-tosca">WILAYAH 1 & 2</h4>
                        <p id="h-prev-w12" class="text-2xl font-bold text-gray-600 mt-2">Rp 0</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow border-t-4 border-gray-300">
                        <h4 class="font-bold text-gray-400 text-xs text-hijau-tosca">WILAYAH 3</h4>
                        <p id="h-prev-w3" class="text-2xl font-bold text-gray-600 mt-2">Rp 0</p>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow border-t-4 border-gray-300">
                        <h4 class="font-bold text-gray-400 text-xs text-hijau-tosca">WILAYAH 4</h4>
                        <p id="h-prev-w4" class="text-2xl font-bold text-gray-600 mt-2">Rp 0</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="profile" class="section">
            <div class="bg-white p-10 rounded-3xl shadow-xl"><h2 class="text-3xl font-bold text-hijau-tua mb-4">Profil Perusahaan</h2><p class="text-gray-600">PT Khatulistiwa Sinar Energi adalah penyedia layanan energi terintegrasi...</p></div>
        </section>

        <section id="visi-misi" class="section">
            <div class="grid md:grid-cols-2 gap-8">
                <div class="bg-hijau-tua text-white p-10 rounded-3xl shadow-lg"><h2 class="text-2xl font-bold mb-4">Visi</h2><p>Menjadi pemimpin distribusi energi bersih nasional.</p></div>
                <div class="bg-hijau-tosca text-white p-10 rounded-3xl shadow-lg"><h2 class="text-2xl font-bold mb-4">Misi</h2><p>Inovasi berkelanjutan dan transparansi administrasi.</p></div>
            </div>
        </section>

        <section id="legalitas" class="section">
            <div class="bg-white p-10 rounded-3xl shadow-lg border-l-8 border-hijau-tua">
                <h2 class="text-2xl font-bold mb-6">Legalitas & Alamat</h2>
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="space-y-2 text-sm">
                        <p><strong>NIB:</strong> 128910111xxx</p>
                        <p><strong>NPWP:</strong> 01.234.567.8-xxx.000</p>
                        <p><strong>Izin:</strong> Niaga Umum BBM</p>
                    </div>
                    <div>
                        <p class="mb-4 italic text-gray-500 font-medium">Jl. Khatulistiwa No. 10, Lantai 2, Jakarta Pusat.</p>
                        <a href="https://wa.me/6281234567890" target="_blank" class="inline-flex items-center bg-green-600 text-white px-6 py-3 rounded-xl font-bold hover:bg-green-700 shadow-lg transition">Chat WhatsApp Admin</a>
                    </div>
                </div>
            </div>
        </section>

        <section id="login" class="section">
            <div class="max-w-md mx-auto bg-white p-10 rounded-3xl shadow-2xl border-t-8 border-hijau-tua">
                <h2 class="text-2xl font-bold text-center mb-6">Sign In</h2>
                <input type="email" id="email" class="w-full border p-4 rounded-xl mb-4" placeholder="Email">
                <input type="password" id="password" class="w-full border p-4 rounded-xl mb-6" placeholder="Password">
                <button onclick="handleLogin()" class="w-full bg-hijau-tua text-white py-4 rounded-xl font-bold shadow-lg">Masuk</button>
            </div>
        </section>

        <section id="dashboard" class="section">
            <div class="flex flex-col md:flex-row justify-between mb-8 gap-4">
                <h2 id="dash-title" class="text-3xl font-bold text-hijau-tua">Administrasi Dokumen</h2>
                <div id="admin-panel" class="hidden flex gap-2">
                    <select id="docType" class="border p-2 rounded-lg text-sm"><option value="PO">PO</option><option value="Surat Jalan">SJ</option><option value="Invoice">INV</option></select>
                    <input type="file" id="fileInput" class="text-xs">
                    <button onclick="uploadFile()" class="bg-hijau-tosca text-white px-4 py-1 rounded-lg font-bold">Upload</button>
                </div>
            </div>
            <div class="bg-white rounded-3xl shadow border overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-hijau-tua text-white"><tr><th class="px-6 py-4">Tipe</th><th class="px-6 py-4">Nama File</th><th class="px-6 py-4 text-center">Aksi</th></tr></thead>
                    <tbody id="file-table-body" class="divide-y italic"></tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        // -- FIREBASE SETUP --
        const firebaseConfig = {
            apiKey: "AIzaSyDenqfuE7Sjy773lp3k7WYh_3RRSr3nojM",
            authDomain: "kse-harga-bbm-update.firebaseapp.com",
            projectId: "kse-harga-bbm-update",
            storageBucket: "kse-harga-bbm-update.firebasestorage.app",
            messagingSenderId: "764165984284",
            appId: "1:764165984284:web:a74aed43317539f5f1cfd9",
            databaseURL: "https://kse-harga-bbm-update-default-rtdb.asia-southeast1.firebasedatabase.app"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // -- SUPABASE SETUP --
        const _supabase = supabase.createClient("https://secasrbeamduxqxwlspv.supabase.co", "sb_publishable_caJyFg1_Z89oUhtKg5XyoA_DfIgh6br");

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }

        // -- REALTIME HARGA (FIREBASE) --
        function listenHarga() {
            db.ref('harga_pertamina').on('value', (snap) => {
                const data = snap.val();
                if (!data) return;

                const mapping = {
                    'now': { 'w12': 'h-now-w12', 'w3': 'h-now-w3', 'w4': 'h-now-w4', 'desc': ['desc-w12', 'desc-w3', 'desc-w4'] },
                    'prev': { 'w12': 'h-prev-w12', 'w3': 'h-prev-w3', 'w4': 'h-prev-w4' }
                };

                // Update harga sekarang & perbandingan
                ['w12', 'w3', 'w4'].forEach((key, idx) => {
                    const nowVal = data.periode_sekarang[key] || 0;
                    const prevVal = data.periode_lalu[key] || 0;
                    const diff = nowVal - prevVal;

                    document.getElementById(mapping.now[key]).innerText = `Rp ${nowVal.toLocaleString()}`;
                    document.getElementById(mapping.prev[key]).innerText = `Rp ${prevVal.toLocaleString()}`;

                    let descEl = document.getElementById(mapping.now.desc[idx]);
                    if (diff > 0) {
                        descEl.innerText = `▲ Naik Rp ${diff.toLocaleString()}`;
                        descEl.style.color = "red";
                    } else if (diff < 0) {
                        descEl.innerText = `▼ Turun Rp ${Math.abs(diff).toLocaleString()}`;
                        descEl.style.color = "green";
                    } else {
                        descEl.innerText = "● Tetap";
                        descEl.style.color = "gray";
                    }
                });
            });
        }
        listenHarga();

        // -- AUTH & DOCS (SUPABASE) --
        async function handleLogin() {
            const { data, error } = await _supabase.auth.signInWithPassword({
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            });
            if (error) return alert("Login Gagal");
            updateAuthUI(data.user);
        }

        function updateAuthUI(user) {
            if (!user) return;
            document.getElementById('btn-login-view').classList.add('hidden');
            document.getElementById('user-logged-in').classList.remove('hidden');
            document.getElementById('display-email').innerText = user.email;
            if (user.email.includes('admin')) document.getElementById('admin-panel').classList.remove('hidden');
            showSection('dashboard');
            loadFiles();
        }

        async function loadFiles() {
            const { data } = await _supabase.from('documents').select('*').order('created_at', { ascending: false });
            renderTable(data);
        }

        function renderTable(files) {
            const tbody = document.getElementById('file-table-body');
            tbody.innerHTML = files.map(f => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 font-bold text-hijau-tosca">${f.type}</td>
                    <td class="px-6 py-4 text-sm">${f.name}</td>
                    <td class="px-6 py-4 text-center"><a href="${f.url}" target="_blank" class="bg-hijau-tua text-white px-4 py-1.5 rounded-lg text-xs font-bold shadow">Download</a></td>
                </tr>
            `).join('');
        }

        function filterFiles(type) {
            showSection('dashboard');
            document.getElementById('dash-title').innerText = "Arsip: " + type;
            _supabase.from('documents').select('*').eq('type', type).then(({data}) => renderTable(data));
        }

        async function handleLogout() { await _supabase.auth.signOut(); location.reload(); }

        _supabase.auth.getSession().then(({data}) => { if (data.session) updateAuthUI(data.session.user); });
    </script>
</body>
</html>






