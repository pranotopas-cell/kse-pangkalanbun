<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PT Khatulistiwa Sinar Energi - Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .section { display: none; opacity: 0; transform: translateY(10px); transition: all 0.4s ease; }
        .section.active { display: block; opacity: 1; transform: translateY(0); }
        .bg-hijau-tua { background-color: #064e3b; }
        .text-hijau-tosca { color: #0d9488; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

    <nav class="sticky top-0 z-50 glass border-b border-slate-200">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3 cursor-pointer group" onclick="showSection('home')">
                <div class="w-10 h-10 bg-hijau-tua rounded-xl flex items-center justify-center font-bold text-white shadow-lg">KSE</div>
                <span class="text-xl font-extrabold tracking-tighter text-emerald-900 uppercase italic">PT KSE</span>
            </div>
            
            <div class="hidden md:flex items-center space-x-8 font-semibold text-slate-600">
                <button onclick="showSection('home')" class="hover:text-emerald-700">Beranda</button>
                <button onclick="showSection('harga-pertamina')" class="hover:text-emerald-700">Harga BBM</button>
                
                <div id="nav-auth-container" class="border-l pl-8 flex items-center space-x-4">
                    <button id="btn-login-view" onclick="showSection('login')" class="bg-hijau-tua text-white px-6 py-2 rounded-full text-sm font-bold shadow-md hover:bg-emerald-800 transition">Sign In Admin</button>
                    
                    <div id="user-logged-in" class="hidden flex items-center space-x-4">
                        <div class="text-right">
                            <p id="display-email" class="text-xs font-bold text-emerald-800"></p>
                            <button id="nav-edit-harga" onclick="showSection('admin-harga')" class="text-[10px] uppercase font-black text-orange-600 hover:underline">Update Harga</button>
                        </div>
                        <button onclick="handleLogout()" class="bg-red-50 text-red-600 p-2 rounded-lg hover:bg-red-100 transition">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7"></path></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-6 py-10">
        <section id="home" class="section active py-16 text-center">
            <h1 class="text-6xl font-black text-emerald-900 mb-6 leading-tight tracking-tighter uppercase">Mengalirkan <br><span class="text-emerald-600 italic">Energi Industri</span></h1>
            <p class="max-w-xl mx-auto text-slate-500 mb-10 font-medium">Mitra resmi distribusi BBM Industri dengan standar ketepatan volume dan transparansi harga terbaik.</p>
            <img src="https://images.unsplash.com/photo-1581094288338-2314dddb7ecc?auto=format&fit=crop&w=800&q=80" class="w-full max-w-3xl mx-auto rounded-[2.5rem] shadow-2xl border-8 border-white">
        </section>

        <section id="harga-pertamina" class="section">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-black text-emerald-900 uppercase italic">Harga Publish BBM Industri</h2>
                <p class="text-emerald-600 font-bold tracking-widest text-xs uppercase">Update Realtime Firestore</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <script>
                    for(let i=1; i<=4; i++){
                        document.write(`
                            <div id="cardwilayah${i}" class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100 hover:shadow-xl transition-all">
                                <h3 class="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">Wilayah ${i}</h3>
                                <p class="text-3xl font-black text-emerald-900 italic mb-3">Rp 0</p>
                                <div class="keteranganKmr text-[10px] font-bold py-1 px-3 rounded-full bg-slate-100 inline-block">Memuat...</div>
                            </div>
                        `);
                    }
                </script>
            </div>
        </section>

        <section id="admin-harga" class="section">
            <div class="max-w-xl mx-auto bg-white p-10 rounded-[2.5rem] shadow-2xl border border-slate-100">
                <h2 class="text-2xl font-black mb-8 text-orange-600 uppercase italic">Update Database Harga</h2>
                <div class="grid grid-cols-2 gap-6">
                    <div><label class="text-[10px] font-bold text-slate-400 ml-2">WILAYAH I</label><input type="number" id="input-w1" class="w-full bg-slate-50 border-none p-4 rounded-2xl focus:ring-2 focus:ring-orange-500 outline-none font-bold text-lg"></div>
                    <div><label class="text-[10px] font-bold text-slate-400 ml-2">WILAYAH II</label><input type="number" id="input-w2" class="w-full bg-slate-50 border-none p-4 rounded-2xl focus:ring-2 focus:ring-orange-500 outline-none font-bold text-lg"></div>
                    <div><label class="text-[10px] font-bold text-slate-400 ml-2">WILAYAH III</label><input type="number" id="input-w3" class="w-full bg-slate-50 border-none p-4 rounded-2xl focus:ring-2 focus:ring-orange-500 outline-none font-bold text-lg"></div>
                    <div><label class="text-[10px] font-bold text-slate-400 ml-2">WILAYAH IV</label><input type="number" id="input-w4" class="w-full bg-slate-50 border-none p-4 rounded-2xl focus:ring-2 focus:ring-orange-500 outline-none font-bold text-lg"></div>
                </div>
                <button onclick="saveHargaBaru()" class="w-full mt-8 bg-orange-600 text-white font-bold py-5 rounded-2xl shadow-lg hover:bg-orange-700 transition transform hover:-translate-y-1">PUBLIKASIKAN PERUBAHAN</button>
            </div>
        </section>

        <section id="login" class="section">
            <div class="max-w-md mx-auto bg-white p-10 rounded-[2.5rem] shadow-2xl text-center border">
                <h2 class="text-3xl font-black mb-2 text-emerald-900 uppercase">Admin Sign In</h2>
                <p class="text-slate-400 text-sm mb-8 font-medium">Gunakan akun Supabase untuk akses</p>
                <div class="space-y-4">
                    <input type="email" id="email" class="w-full bg-slate-50 border-none p-4 rounded-2xl focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="Email Admin">
                    <input type="password" id="password" class="w-full bg-slate-50 border-none p-4 rounded-2xl focus:ring-2 focus:ring-emerald-500 outline-none" placeholder="Password">
                    <button id="btn-do-login" onclick="handleLogin()" class="w-full bg-emerald-900 text-white py-4 rounded-2xl font-bold shadow-lg hover:scale-105 transition transform">Masuk Portal</button>
                </div>
            </div>
        </section>

        <section id="dashboard" class="section">
            <div class="flex justify-between items-end mb-8">
                <h2 id="dash-title" class="text-3xl font-black text-emerald-900 uppercase italic">Arsip Dokumen</h2>
                <p class="text-slate-400 text-xs font-bold">Terhubung ke Supabase Storage</p>
            </div>
            <div class="bg-white rounded-[2rem] shadow-sm border border-slate-100 overflow-hidden">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 border-b border-slate-100 text-slate-500 text-[10px] uppercase font-black tracking-widest">
                        <tr><th class="px-8 py-5">Jenis</th><th class="px-8 py-5">Nama Dokumen</th><th class="px-8 py-5 text-center">Aksi</th></tr>
                    </thead>
                    <tbody id="file-table-body" class="divide-y divide-slate-50">
                        </tbody>
                </table>
            </div>
        </section>
    </main>

    <script>
        // -- INITIALIZE FIREBASE --
        const firebaseConfig = {
            apiKey: "AIzaSyDenqfuE7Sjy773lp3k7WYh_3RRSr3nojM",
            authDomain: "kse-harga-bbm-update.firebaseapp.com",
            projectId: "kse-harga-bbm-update",
            storageBucket: "kse-harga-bbm-update.firebasestorage.app",
            messagingSenderId: "764165984284",
            appId: "1:764165984284:web:a74aed43317539f5f1cfd9"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // -- INITIALIZE SUPABASE --
        const _supabase = supabase.createClient("https://secasrbeamduxqxwlspv.supabase.co", "sb_publishable_caJyFg1_Z89oUhtKg5XyoA_DfIgh6br");

        // -- CORE UI LOGIC --
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => {
                s.classList.remove('active');
                s.style.display = 'none';
            });
            const activeSec = document.getElementById(id);
            if (activeSec) {
                activeSec.style.display = 'block';
                setTimeout(() => activeSec.classList.add('active'), 50);
            }
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // -- HARGA REALTIME (FIRESTORE) --
        let hargaSekarangGlobal = {};
        function initHarga() {
            db.collection("hargaBBM").doc("periode").onSnapshot((doc) => {
                if (!doc.exists) return;
                const data = doc.data();
                hargaSekarangGlobal = data.sekarang || {};

                for(let i=1; i<=4; i++) {
                    const w = `wilayah${i}`;
                    const now = parseInt(data.sekarang?.[w] || 0);
                    const prev = parseInt(data.kemarin?.[w] || 0);
                    const diff = now - prev;
                    
                    const card = document.getElementById(`cardwilayah${i}`);
                    if (!card) continue;

                    card.querySelector('p').innerText = `Rp ${now.toLocaleString('id-ID')}`;
                    const ket = card.querySelector('.keteranganKmr');
                    
                    if(diff > 0) {
                        ket.innerText = `▲ Naik Rp ${diff.toLocaleString()}`;
                        ket.className = "keteranganKmr text-[10px] font-bold py-1 px-3 rounded-full bg-red-50 text-red-600";
                    } else if(diff < 0) {
                        ket.innerText = `▼ Turun Rp ${Math.abs(diff).toLocaleString()}`;
                        ket.className = "keteranganKmr text-[10px] font-bold py-1 px-3 rounded-full bg-emerald-50 text-emerald-600";
                    } else {
                        ket.innerText = "● Stabil";
                        ket.className = "keteranganKmr text-[10px] font-bold py-1 px-3 rounded-full bg-slate-100 text-slate-500";
                    }
                }
            });
        }

        async function saveHargaBaru() {
            const vals = {
                wilayah1: document.getElementById('input-w1').value,
                wilayah2: document.getElementById('input-w2').value,
                wilayah3: document.getElementById('input-w3').value,
                wilayah4: document.getElementById('input-w4').value
            };
            if(!vals.wilayah1 || !vals.wilayah2) return alert("Lengkapi data!");

            try {
                await db.collection("hargaBBM").doc("periode").update({
                    kemarin: hargaSekarangGlobal,
                    sekarang: vals
                });
                alert("Harga Berhasil di Update!");
                showSection('harga-pertamina');
            } catch (e) { alert("Gagal Simpan. Cek Login Admin Anda."); }
        }

        // -- SUPABASE AUTH & FILES --
        async function handleLogin() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const btn = document.getElementById('btn-do-login');

            btn.innerText = "Loading...";
            btn.disabled = true;

            const { data, error } = await _supabase.auth.signInWithPassword({ email, password });

            if (error) {
                alert("Login Gagal: " + error.message);
                btn.innerText = "Masuk Portal";
                btn.disabled = false;
            } else {
                updateAuthUI(data.user);
            }
        }

        function updateAuthUI(user) {
            if (!user) return;
            document.getElementById('btn-login-view').classList.add('hidden');
            document.getElementById('user-logged-in').classList.remove('hidden');
            document.getElementById('display-email').innerText = user.email;
            document.getElementById('nav-edit-harga').classList.remove('hidden');
            
            showSection('dashboard');
            loadDocuments();
        }

        async function loadDocuments() {
            const { data, error } = await _supabase.from('documents').select('*');
            const tbody = document.getElementById('file-table-body');
            
            if (error || !data) {
                tbody.innerHTML = `<tr><td colspan="3" class="px-8 py-10 text-center text-slate-400 italic">Data tidak dapat dimuat.</td></tr>`;
                return;
            }

            tbody.innerHTML = data.map(doc => `
                <tr class="hover:bg-slate-50 transition">
                    <td class="px-8 py-5"><span class="bg-emerald-50 text-emerald-700 px-3 py-1 rounded text-[10px] font-black uppercase tracking-tighter">${doc.type}</span></td>
                    <td class="px-8 py-5 text-sm font-bold text-slate-700">${doc.name}</td>
                    <td class="px-8 py-5 text-center">
                        <a href="${doc.url}" target="_blank" class="bg-slate-900 text-white px-5 py-2 rounded-xl text-[10px] font-bold hover:bg-emerald-600 transition shadow-lg">DOWNLOAD</a>
                    </td>
                </tr>
            `).join('');
        }

        async function handleLogout() {
            await _supabase.auth.signOut();
            window.location.reload();
        }

        // -- INITIALIZE ON LOAD --
        window.addEventListener('DOMContentLoaded', async () => {
            initHarga();
            
            // Auto-check session
            const { data: { session } } = await _supabase.auth.getSession();
            if (session) {
                updateAuthUI(session.user);
            }
        });
    </script>
</body>
</html>








