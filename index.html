<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KSE - Khatulistiwa Sinar Energi</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { font-family: Arial; margin:0; padding:0; }
header { background:#007bff; color:white; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
nav a { color:white; margin-right:15px; text-decoration:none; }
nav a:hover { text-decoration:underline; }
main { padding:20px; }
.box { background:white; padding:20px; border-radius:10px; margin-bottom:20px; }
button { padding:8px 12px; background:#007bff; color:white; border:none; cursor:pointer; border-radius:5px; }
button:hover { background:#0056b3; }
</style>
</head>
<body>

<!-- HEADER / MENU -->
<header>
  <div><strong>KSE</strong></div>
  <nav>
    <a href="#tentang">Tentang Kami</a>
    <a href="#legalitas">Legalitas</a>
    <a href="#kontak">Kontak</a>
    <a href="#kegiatan">Kegiatan</a>
    <a href="#" id="loginBtn">Login</a>
  </nav>
</header>

<!-- LANDING PAGE -->
<main id="landingPage">
  <section id="tentang" class="box">
    <h2>Tentang Kami</h2>
    <p>KSE - Mitra penyalur dan transportir BBM industri di Kalimantan Tengah.</p>
  </section>

  <section id="legalitas" class="box">
    <h2>Legalitas</h2>
    <p>Legalitas perusahaan, izin, dan sertifikasi.</p>
  </section>

  <section id="kontak" class="box">
    <h2>Kontak</h2>
    <p>Telepon: 08158841410 <br> Email: info@kse.co.id</p>
  </section>

  <section id="kegiatan" class="box">
    <h2>Kegiatan</h2>
    <p>Kegiatan operasional, distribusi BBM industri.</p>
  </section>
</main>

<!-- LOGIN & APP BOX (hanya muncul kalau klik login) -->
<div id="appContainer" style="display:none;">
  <div class="box" id="loginBox">
    <h2>Login</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
  </div>

  <div class="box" id="appBox" style="display:none;">
    <h2>Upload PDF / Dokumen</h2>
    <input type="file" id="fileInput">
    <input type="text" id="typeInput" placeholder="Tipe Dokumen">
    <button onclick="uploadFile()">Upload</button>
    <button onclick="logout()">Logout</button>

    <h3>Daftar Dokumen</h3>
    <div id="fileList"></div>
  </div>
</div>

<script>
const supabaseClient = window.supabase.createClient(
  "https://secasrbeamduxqxwlspv.supabase.co",
  "sb_publishable_caJyFg1_Z89oUhtKg5XyoA_DfIgh6br"
);

// TOMBOL LOGIN di menu
document.getElementById("loginBtn").addEventListener("click", () => {
  document.getElementById("landingPage").style.display = "none";
  document.getElementById("appContainer").style.display = "block";
  document.getElementById("loginBox").style.display = "block";
});

// ------------------------
// Cek session
// ------------------------
checkSession();
async function checkSession() {
  const { data } = await supabaseClient.auth.getSession();
  if(data.session){
    document.getElementById("landingPage").style.display = "none";
    document.getElementById("appContainer").style.display = "block";
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("appBox").style.display = "block";
    loadFiles();
  }
}

// ------------------------
// Login
// ------------------------
async function login() {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  if(!email || !password) return alert("Email dan password harus diisi");

  const { error } = await supabaseClient.auth.signInWithPassword({ email, password });

  if(error){
    alert("Login gagal: " + error.message);
  } else {
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("appBox").style.display = "block";
    loadFiles();
  }
}

// ------------------------
// Upload File
// ------------------------
async function uploadFile() {
  const file = document.getElementById("fileInput").files[0];
  const type = document.getElementById("typeInput").value;

  if(!file) return alert("Pilih file dulu");
  if(!type) return alert("Tulis tipe dokumen");

  const { data: userData } = await supabaseClient.auth.getUser();
  const user = userData.user;
  const filePath = `${user.email}/${file.name}`;

  const { error: uploadError } = await supabaseClient
    .storage.from("documents").upload(filePath, file, { upsert:true });

  if(uploadError) return alert("Upload gagal: "+uploadError.message);

  const { data: publicURL } = supabaseClient
    .storage.from("documents").getPublicUrl(filePath);

  await supabaseClient.from("documents").insert([
    { pt_email:user.email, type:type, file_name:file.name, file_url:publicURL.publicUrl }
  ]);

  alert("Upload berhasil");
  loadFiles();
}

// ------------------------
// Load Files
// ------------------------
async function loadFiles() {
  const { data: userData } = await supabaseClient.auth.getUser();
  const user = userData.user;

  const { data, error } = await supabaseClient
    .from("documents").select("*").eq("pt_email", user.email);

  if(error) return console.error(error);

  let html = "";
  if(!data || data.length===0){
    html="<p>Belum ada dokumen</p>";
  } else {
    data.forEach(f => {
      html+=`<p>${f.file_name} - ${f.type} <a href="${f.file_url}" target="_blank">Lihat</a></p>`;
    });
  }

  document.getElementById("fileList").innerHTML=html;
}

// ------------------------
// Logout
// ------------------------
async function logout(){
  await supabaseClient.auth.signOut();
  location.reload();
}
</script>

</body>
</html>


